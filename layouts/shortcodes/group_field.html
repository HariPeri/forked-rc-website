<div class="form-item form-group form-type-textfield">
  <label class="control-label" for="mygroups-group">
    Name of Grouper/MyGroup Account
    <span class="form-required" title="This field is required.">*</span>
    <span style="font-weight:normal;"><br />
      Lowercase only, no spaces, PI must
      <a href="https://in.virginia.edu/how-to-request-group" target="_new">create a new, unique Grouper group</a>
      for new allocations.
    </span>
  </label>

  {{ $.Page.RenderString "{{% group_creation_tip %}}" }}

  <input
    required="required"
    class="form-control form-text required"
    type="text"
    id="mygroups-group"
    name="mygroups-group"
    value=""
    size="60"
    aria-describedby="mygroups-group-help"
    maxlength="128"
  />

  <small id="mygroups-group-help" class="form-text text-muted mt-1" aria-live="polite">
    0/40 characters (max 40).
  </small>
</div>

<script>
  (function () {
    const max = 40;
    const input = document.getElementById('mygroups-group');
    const help  = document.getElementById('mygroups-group-help');

    function update() {
      const max = 40; // if not already in scope
      const raw = input.value;
      const len = raw.trim().length; // ignore pure whitespace

      if (len === 0) {
        input.setCustomValidity('Please fill out this field.');
        input.setAttribute('aria-invalid', 'true');
        help.classList.add('text-danger');
        help.textContent = `Required. 0/${max} characters (max ${max}).`;
      } else if (len > max) {
        input.setCustomValidity(`Please shorten to ${max} characters or fewer.`);
        input.setAttribute('aria-invalid', 'true');
        help.classList.add('text-danger');
        help.textContent = `Too long: ${len}/${max}. Please shorten.`;
      } else {
        input.setCustomValidity('');
        input.removeAttribute('aria-invalid');
        help.classList.remove('text-danger');
        help.textContent = `${len}/${max} characters (max ${max}).`;
      }
    }

    input.addEventListener('input', update);
    update();
  })();
</script>