<!-- Status -->
<section class="sidebar-module">
<p class=lead>System Status</p>
<div style="width:98%;">
  <div style="">
  <table class="table table-sm table-responsive status-tbl table-striped" style="width:100%;border:solid 1px #f5f5f5;">
    <thead class="thead-inverse">
      <tr>
        <th scope="row">System</th>
        <th align="center" style="text-align:center;">Status</th>
      </tr>
    </thead>
    <tbody id="statusBody"></tbody>
  </table>
  </div>
</div>
</section>
<script>
$(document).ready(function() {
  $("#status-message").hide();
  refreshStatusTable();
  setInterval(refreshStatusTable, 60000);
  checkStatusMessages();
  setInterval(checkStatusMessages, 60000);
});
function checkStatusMessages() {
  $.getJSON('https://tja4lfp3da.execute-api.us-east-1.amazonaws.com/api/messages', function(data) {
    var messageData = '';
    $.each(data, function(key, value) {
      var messageBody = value.body;
      var messageLength = messageBody.length;
      if ( messageLength < 22 ) {
        $("#status-message").hide();
      } else {
        $("#status-message").show();
        messageData += '<span style="color:tomato;padding-right:4px;"><i class="fas fa-exclamation-triangle"></i></span>';
        /*
        messageData += value.body;
        */
          messageData += '2024-02-27 11:50 am EST: <br>On February 26 at 9:00 am EST, RC engineers initiated the switch to an alternate data transfer mechanism between the legacy Research Project Storage filesystem and the new Project Storage system. As a result, users no longer have direct access to the legacy system. As a part of this process, stub files linking to the legacy system were also attempted to be deleted. A subset of these stub files remains visible on the new system, but attempting to access them will result in File Not Found Errors, as they are no longer coupled with the old system. These files are scheduled for deletion through an automated process eventually. Files are now being staged to an intermediate location.<br><br> To aid in the migration process, a text file containing a comprehensive list of old Project storage files has been deposited into a new /stagedproject folder on Rivanna. Users can utilize this list to specify which folders or files should be prioritized for transfer by completing our <a href="https://rc.virginia.edu/form/support-request/?category=Storage&request_title=Project%20storage%20data%20migration&description=Please%20indicate%20as%20precisely%20as%20possible%20which%20directories%20or%20files%20should%20be%20transferred%20first:">data transfer request form</a>. For further details regarding the file transfer efforts and the status of the Project Storage system, users can refer to our <a href="https://www.rc.virginia.edu/service/status/">Data Migration status page</a>. Additionally, please note that Project storage is presently unavailable on Open OnDemand.'
        $('#status-message-content').html(messageData);
      }
    });
  });
};
function refreshStatusTable(){
  $.getJSON('https://tja4lfp3da.execute-api.us-east-1.amazonaws.com/api/grid', function(data) {
    var statusData = '';
    $.each(data, function(key, value) {
      statusData += '<tr>';
      statusData += '<td style="vertical-align:middle;" valign="middle"><a href="'+value.url+'" style="text-decoration:none;color:black;">'+value.title+'</a></td>';
      statusData += '<td class="" style="vertical-align:middle;" valign="middle" align="center"><img style="" src='+value.image+' /></td>';
      statusData += '</tr>';
    });
    $('#statusBody').html(statusData);
  });
};
</script>
<!-- /Status -->
